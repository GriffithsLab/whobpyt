
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="auto">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Replicating Ismail et al. 2025 &#8212; MNE  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "auto";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "auto";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/css/fix-sidebar.css?v=52f27943" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css?v=1395d0ad" />
    <link rel="stylesheet" type="text/css" href="../_static/css/fix-sidebar.css?v=52f27943" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=7f41d439"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=fd10adb8"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-5TBCPCRB6X"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-5TBCPCRB6X');
            </script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-5TBCPCRB6X');
            </script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'auto_examples/eg__ismail2025';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="canonical" href="https://mne.tools/stable/auto_examples/eg__ismail2025.html" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />

  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="auto">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/whobpyt_logo_feet.png" class="logo__image only-light" alt="MNE  documentation - Home"/>
    <img src="../_static/whobpyt_logo_feet_dark.png" class="logo__image only-dark pst-js-only" alt="MNE  documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../documentation/about/index.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../documentation/index.html">
    Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../documentation/science/index.html">
    Science
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../documentation/development/index.html">
    Contribute
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="External Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/griffithslab/whobpyt" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-fw fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../documentation/about/index.html">
    About
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../documentation/index.html">
    Documentation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../documentation/science/index.html">
    Science
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../documentation/development/index.html">
    Contribute
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="External Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/griffithslab/whobpyt" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-fw fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none"></div>
              
              
<div>
  
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-eg-ismail2025-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="replicating-ismail-et-al-2025">
<span id="sphx-glr-auto-examples-eg-ismail2025-py"></span><h1>Replicating Ismail et al. 2025<a class="headerlink" href="#replicating-ismail-et-al-2025" title="Link to this heading">#</a></h1>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<section id="overview">
<h2>0. Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>This example replicates modelling in the Ismail et al. 2025 paper.
The code includes data fetching, model fitting, and result visualization based on the methods presented in the paper.</p>
<p>Summary of paper
In this study, we explore the mechanisms underlying language lateralization in childhood
using personalized whole-brain network models. Our findings reveal that interhemispheric inhibitory
circuits play a crucial role in shaping lateralized language function, with local inhibition decreasing
over development while interhemispheric inhibition increases. Using systematic model manipulations and virtual
transplant experiments, we show that the reduction in local inhibition allows pre-existing asymmetries in interhemispheric
inhibition to drive laterality. This work provides a developmental framework for understanding how inhibitory circuits shape language networks.</p>
<img alt="Ismail et al. 2025 Figure 1" class="align-center" src="https://github.com/griffithslab/whobpyt/doc/_static/Ismail2025_Figure1.png" />
<p>This is Figure 1 from the paper, we will begin by replicating the results for one subject in this figure</p>
</section>
<section id="setup">
<h2>1. Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h2>
<p>Imports:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">torch.optim</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">optim</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">torch.nn.parameter</span><span class="w"> </span><span class="kn">import</span> <span class="n">Parameter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics.pairwise</span><span class="w"> </span><span class="kn">import</span> <span class="n">cosine_similarity</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gdown</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">loadmat</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">whobpyt.depr.ismail2025.jansen_rit</span><span class="w"> </span><span class="kn">import</span> <span class="n">ParamsModel</span><span class="p">,</span> <span class="n">RNNJANSEN</span><span class="p">,</span> <span class="n">Model_fitting</span><span class="p">,</span> <span class="n">dataloader</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">whobpyt.datasets.fetchers</span><span class="w"> </span><span class="kn">import</span> <span class="n">fetch_egismail2025</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">mne</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.signal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span>
</pre></div>
</div>
</section>
<section id="download-data">
<h2>2. Download data<a class="headerlink" href="#download-data" title="Link to this heading">#</a></h2>
<p>We use an example dataset for one subject on a public Google Drive folder</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">fetch_egismail2025</span><span class="p">()</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Downloading file 1 of 12: distance.txt


Downloading distance.txt

Downloading...
From: https://drive.google.com/uc?id=1P4WSVLiWDdoK_S2cSlDyt1V7JuphfsaZ
To: /home/runner/.whobpyt/data/eg__ismail2025/distance.txt

  0%|          | 0.00/569k [00:00&lt;?, ?B/s]
100%|██████████| 569k/569k [00:00&lt;00:00, 13.4MB/s]
Downloading file 2 of 12: emp_noise_source.npy


Downloading emp_noise_source.npy

Downloading...
From (original): https://drive.google.com/uc?id=1hubOoaJcCExawBKk-fpxNXSmSi-dx2-v
From (redirected): https://drive.google.com/uc?id=1hubOoaJcCExawBKk-fpxNXSmSi-dx2-v&amp;confirm=t&amp;uuid=c68e65ca-b2d3-44d8-9870-b51356a83a71
To: /home/runner/.whobpyt/data/eg__ismail2025/emp_noise_source.npy

  0%|          | 0.00/200M [00:00&lt;?, ?B/s]
  0%|          | 524k/200M [00:00&lt;00:54, 3.69MB/s]
  1%|          | 1.05M/200M [00:00&lt;00:54, 3.68MB/s]
  1%|          | 1.57M/200M [00:00&lt;00:54, 3.67MB/s]
  1%|▏         | 2.62M/200M [00:00&lt;00:37, 5.33MB/s]
  2%|▏         | 4.19M/200M [00:00&lt;00:23, 8.29MB/s]
  8%|▊         | 15.2M/200M [00:00&lt;00:05, 36.7MB/s]
 16%|█▋        | 33.0M/200M [00:00&lt;00:02, 76.9MB/s]
 24%|██▍       | 48.2M/200M [00:00&lt;00:01, 98.5MB/s]
 33%|███▎      | 65.5M/200M [00:01&lt;00:01, 120MB/s]
 41%|████      | 81.3M/200M [00:01&lt;00:00, 131MB/s]
 51%|█████     | 102M/200M [00:01&lt;00:00, 154MB/s]
 59%|█████▉    | 118M/200M [00:01&lt;00:00, 150MB/s]
 67%|██████▋   | 134M/200M [00:01&lt;00:00, 145MB/s]
 76%|███████▌  | 152M/200M [00:01&lt;00:00, 154MB/s]
 85%|████████▍ | 169M/200M [00:01&lt;00:00, 159MB/s]
 93%|█████████▎| 186M/200M [00:01&lt;00:00, 154MB/s]
100%|██████████| 200M/200M [00:01&lt;00:00, 105MB/s]
Downloading file 3 of 12: emp_verb_source.npy


Downloading emp_verb_source.npy

Downloading...
From (original): https://drive.google.com/uc?id=1frpLiDxwdduE1LAOWGPCSDTETTWjkKUh
From (redirected): https://drive.google.com/uc?id=1frpLiDxwdduE1LAOWGPCSDTETTWjkKUh&amp;confirm=t&amp;uuid=f21839c5-d815-4740-a6d8-853ec4767cad
To: /home/runner/.whobpyt/data/eg__ismail2025/emp_verb_source.npy

  0%|          | 0.00/209M [00:00&lt;?, ?B/s]
  1%|          | 1.05M/209M [00:00&lt;00:24, 8.43MB/s]
  2%|▏         | 4.72M/209M [00:00&lt;00:10, 20.3MB/s]
  8%|▊         | 16.3M/209M [00:00&lt;00:03, 57.7MB/s]
 11%|█         | 23.1M/209M [00:00&lt;00:05, 36.2MB/s]
 17%|█▋        | 35.1M/209M [00:00&lt;00:03, 55.7MB/s]
 20%|██        | 42.5M/209M [00:00&lt;00:03, 50.5MB/s]
 23%|██▎       | 48.8M/209M [00:01&lt;00:03, 43.2MB/s]
 30%|███       | 63.4M/209M [00:01&lt;00:02, 64.9MB/s]
 37%|███▋      | 78.1M/209M [00:01&lt;00:01, 83.2MB/s]
 44%|████▍     | 92.3M/209M [00:01&lt;00:01, 97.1MB/s]
 52%|█████▏    | 110M/209M [00:01&lt;00:00, 109MB/s]
 61%|██████    | 127M/209M [00:01&lt;00:00, 126MB/s]
 67%|██████▋   | 141M/209M [00:01&lt;00:00, 94.9MB/s]
 75%|███████▌  | 157M/209M [00:02&lt;00:00, 108MB/s]
 83%|████████▎ | 172M/209M [00:02&lt;00:00, 81.9MB/s]
 93%|█████████▎| 194M/209M [00:02&lt;00:00, 106MB/s]
100%|█████████▉| 208M/209M [00:02&lt;00:00, 96.3MB/s]
100%|██████████| 209M/209M [00:02&lt;00:00, 80.8MB/s]
Downloading file 4 of 12: info.pkl


Downloading info.pkl

Downloading...
From: https://drive.google.com/uc?id=1HpMJzTzxNn-YItSo_GJvCpI3EEuvVWUP
To: /home/runner/.whobpyt/data/eg__ismail2025/info.pkl

  0%|          | 0.00/59.0k [00:00&lt;?, ?B/s]
100%|██████████| 59.0k/59.0k [00:00&lt;00:00, 3.35MB/s]
Downloading file 5 of 12: leadfield_3d.mat


Downloading leadfield_3d.mat

Downloading...
From (original): https://drive.google.com/uc?id=1gtVxgl1z6QQKDyuxlWdePUpU__i2Njba
From (redirected): https://drive.google.com/uc?id=1gtVxgl1z6QQKDyuxlWdePUpU__i2Njba&amp;confirm=t&amp;uuid=4d287532-9150-4a78-9abf-3ee70324d4ee
To: /home/runner/.whobpyt/data/eg__ismail2025/leadfield_3d.mat

  0%|          | 0.00/1.16M [00:00&lt;?, ?B/s]
100%|██████████| 1.16M/1.16M [00:00&lt;00:00, 20.3MB/s]
Downloading file 6 of 12: noise_evoked.npy


Downloading noise_evoked.npy

Downloading...
From: https://drive.google.com/uc?id=1rgaPu3fRPYxRb6EHkFac4ahC0McbBBJb
To: /home/runner/.whobpyt/data/eg__ismail2025/noise_evoked.npy

  0%|          | 0.00/1.09M [00:00&lt;?, ?B/s]
100%|██████████| 1.09M/1.09M [00:00&lt;00:00, 18.2MB/s]
Downloading file 7 of 12: sim_noise_sensor.npy


Downloading sim_noise_sensor.npy

Downloading...
From: https://drive.google.com/uc?id=1Lr3VV69jBVkNWqz7iPxJHVmflgBTsyYq
To: /home/runner/.whobpyt/data/eg__ismail2025/sim_noise_sensor.npy

  0%|          | 0.00/1.64M [00:00&lt;?, ?B/s]
100%|██████████| 1.64M/1.64M [00:00&lt;00:00, 26.2MB/s]
Downloading file 8 of 12: sim_noise_source.npy


Downloading sim_noise_source.npy

Downloading...
From: https://drive.google.com/uc?id=18os1jbGZS2si7_0p1bb7nplHEKYqW54J
To: /home/runner/.whobpyt/data/eg__ismail2025/sim_noise_source.npy

  0%|          | 0.00/1.10M [00:00&lt;?, ?B/s]
100%|██████████| 1.10M/1.10M [00:00&lt;00:00, 19.5MB/s]
Downloading file 9 of 12: sim_verb_sensor.npy


Downloading sim_verb_sensor.npy

Downloading...
From: https://drive.google.com/uc?id=1pSVY_YPic5mFAoU3xX99HzejS5Fq0ezW
To: /home/runner/.whobpyt/data/eg__ismail2025/sim_verb_sensor.npy

  0%|          | 0.00/1.64M [00:00&lt;?, ?B/s]
100%|██████████| 1.64M/1.64M [00:00&lt;00:00, 26.1MB/s]
Downloading file 10 of 12: sim_verb_source.npy


Downloading sim_verb_source.npy

Downloading...
From: https://drive.google.com/uc?id=1DCLLXr7e6y4o9Gs9sQhGDWrRO6HJU7Oe
To: /home/runner/.whobpyt/data/eg__ismail2025/sim_verb_source.npy

  0%|          | 0.00/1.10M [00:00&lt;?, ?B/s]
100%|██████████| 1.10M/1.10M [00:00&lt;00:00, 17.7MB/s]
Downloading file 11 of 12: verb_evoked.npy


Downloading verb_evoked.npy

Downloading...
From: https://drive.google.com/uc?id=1VKCFgHQ78rraTvyJxVWBYevm4omMYMxG
To: /home/runner/.whobpyt/data/eg__ismail2025/verb_evoked.npy

  0%|          | 0.00/1.09M [00:00&lt;?, ?B/s]
100%|██████████| 1.09M/1.09M [00:00&lt;00:00, 18.6MB/s]
Downloading file 12 of 12: weights.csv


Downloading weights.csv

Downloading...
From: https://drive.google.com/uc?id=1zFBPr25WZEPJVICLx19-JS3XQESsQVNu
To: /home/runner/.whobpyt/data/eg__ismail2025/weights.csv

  0%|          | 0.00/288k [00:00&lt;?, ?B/s]
100%|██████████| 288k/288k [00:00&lt;00:00, 7.01MB/s]
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Load Functional Data</p></li>
</ol>
<blockquote>
<div><p>We will use MEG data recorded during a covert verb generation task in verb generation trials and noise trials</p>
</div></blockquote>
<p>Evoked MEG data averaged across trials (-100 to 400 ms)</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">verb_meg_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;verb_evoked.npy&#39;</span><span class="p">))</span>   <span class="c1"># (time, channels)</span>
<span class="n">noise_meg_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;noise_evoked.npy&#39;</span><span class="p">))</span> <span class="c1"># (time, channels)</span>
<span class="c1"># Normalize both signals</span>
<span class="n">verb_meg</span> <span class="o">=</span> <span class="n">verb_meg_raw</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">verb_meg_raw</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1</span>
<span class="n">noise_meg</span> <span class="o">=</span> <span class="n">noise_meg_raw</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">noise_meg_raw</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="load-forward-model-input">
<h2>4. Load Forward Model Input<a class="headerlink" href="#load-forward-model-input" title="Link to this heading">#</a></h2>
<p>We will use the leadfield to simulate MEG activty from sources derived from the individual’s head model</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">leadfield</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;leadfield_3d.mat&#39;</span><span class="p">))</span>  <span class="c1"># shape (sources, sensors, 3)</span>
<span class="n">lm_3d</span> <span class="o">=</span> <span class="n">leadfield</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">]</span>  <span class="c1"># 3D leadfield matrix</span>
<span class="c1"># Convert 3D to 2D using SVD-based projection</span>
<span class="n">lm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lm_3d</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">sources</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lm_3d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">lm_3d</span><span class="p">[</span><span class="n">sources</span><span class="p">])</span>
    <span class="n">lm</span><span class="p">[</span><span class="n">sources</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[:,:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># Scale the leadfield matrix</span>
<span class="n">lm</span> <span class="o">=</span> <span class="n">lm</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="mf">1e-11</span> <span class="o">*</span> <span class="mi">5</span>  <span class="c1"># Shape: (channels, sources)</span>
</pre></div>
</div>
</section>
<section id="load-structure">
<h2>5. Load Structure<a class="headerlink" href="#load-structure" title="Link to this heading">#</a></h2>
<p>We will use the individual’s weights and distance matrices</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">sc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;weights.csv&#39;</span><span class="p">),</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">sc_df</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">sc</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;distance.txt&#39;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="put-it-all-together-and-fit-the-model">
<h2>6. Put it all together and fit the model<a class="headerlink" href="#put-it-all-together-and-fit-the-model" title="Link to this heading">#</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">node_size</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">output_size</span> <span class="o">=</span> <span class="n">verb_meg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">step_size</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">input_size</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">num_epoches</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1">#used 250 in paper using 2 for example</span>
<span class="n">tr</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">state_size</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">base_batch_num</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">time_dim</span> <span class="o">=</span> <span class="n">verb_meg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tr</span><span class="o">/</span><span class="n">step_size</span><span class="p">)</span>
<span class="c1"># Format input data</span>
<span class="n">data_verb</span> <span class="o">=</span> <span class="n">dataloader</span><span class="p">(</span><span class="n">verb_meg</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">num_epoches</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
<span class="n">data_noise</span> <span class="o">=</span> <span class="n">dataloader</span><span class="p">(</span><span class="n">noise_meg</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">num_epoches</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
<span class="c1">#To simulate the auditory inputs in this task we will stimulate the auditory cortices</span>
<span class="c1">#These nodes were identified using an ROI mask of left and right Heschl’s gyri based on the Talairach Daemon database</span>
<span class="n">ki0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">node_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">ki0</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1">#initiate leadfield matrices</span>
<span class="n">lm_n</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">output_size</span><span class="p">,</span> <span class="n">node_size</span><span class="p">)</span>
<span class="n">lm_v</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">output_size</span><span class="p">,</span> <span class="n">node_size</span><span class="p">)</span>
<span class="n">par</span> <span class="o">=</span> <span class="n">ParamsModel</span><span class="p">(</span><span class="s1">&#39;JR&#39;</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.25</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">a</span><span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">B</span> <span class="o">=</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="o">=</span><span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g_f</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">g_b</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>\
                    <span class="n">c1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">135</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">135</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">135</span><span class="o">*</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c4</span> <span class="o">=</span> <span class="p">[</span><span class="mi">135</span><span class="o">*</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>\
                    <span class="n">std_in</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">vmax</span><span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">v0</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="p">[</span><span class="mf">0.56</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y0</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span> <span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>\
                    <span class="n">mu</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">kE</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">kI</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">cy0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ki</span><span class="o">=</span><span class="p">[</span><span class="n">ki0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">lm</span><span class="o">=</span><span class="p">[</span><span class="n">lm</span><span class="o">+</span><span class="n">lm_n</span><span class="p">,</span> <span class="mf">.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">output_size</span><span class="p">,</span> <span class="n">node_size</span><span class="p">))</span><span class="o">+</span><span class="n">lm_v</span><span class="p">])</span>
<span class="c1">#Fit two models: 1) verb generation trials and noise trials</span>
<span class="n">verb_model</span> <span class="o">=</span> <span class="n">RNNJANSEN</span><span class="p">(</span><span class="n">node_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">lm</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span>
<span class="n">verb_model</span><span class="o">.</span><span class="n">setModelParameters</span><span class="p">()</span>
<span class="c1">#Stimulate the auditory cortices defined by roi in ki0</span>
<span class="n">stim_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">node_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">time_dim</span><span class="p">))</span>
<span class="n">stim_input</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">100</span><span class="p">:</span><span class="mi">140</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="c1">#Fit models</span>
<span class="n">verb_F</span> <span class="o">=</span> <span class="n">Model_fitting</span><span class="p">(</span><span class="n">verb_model</span><span class="p">,</span> <span class="n">data_verb</span><span class="p">,</span> <span class="n">num_epoches</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">verb_F</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">stim_input</span><span class="p">)</span>
<span class="n">verb_F</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">base_batch_num</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">stim_input</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished fitting model to verb trials&quot;</span><span class="p">)</span>
<span class="c1">#repeat for noise</span>
<span class="n">noise_model</span> <span class="o">=</span> <span class="n">RNNJANSEN</span><span class="p">(</span><span class="n">node_size</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">tr</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="n">lm</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span>
<span class="n">noise_model</span><span class="o">.</span><span class="n">setModelParameters</span><span class="p">()</span>
<span class="n">noise_F</span> <span class="o">=</span> <span class="n">Model_fitting</span><span class="p">(</span><span class="n">noise_model</span><span class="p">,</span> <span class="n">data_noise</span><span class="p">,</span> <span class="n">num_epoches</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">noise_F</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">stim_input</span><span class="p">)</span>
<span class="n">noise_F</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">base_batch_num</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">stim_input</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished fitting model to noise trials&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Parameter containing:
tensor([[-0.1459,  0.0497, -0.3422,  ..., -0.5463,  0.3432,  0.1252],
        [-0.0474,  0.5855, -0.1972,  ..., -1.1779,  0.8516,  0.1308],
        [-0.0075,  0.9350, -0.1395,  ..., -1.4121,  1.1840,  0.0991],
        ...,
        [ 0.3087,  0.0927,  0.5309,  ..., -0.2467, -0.3136, -0.3205],
        [ 0.0610, -0.0505,  0.2432,  ..., -0.1377, -0.1303, -0.0180],
        [ 0.6588,  0.8197,  0.7376,  ..., -0.5250, -0.9487, -0.7905]],
       requires_grad=True)
epoch:  0 -225600.72
epoch:  0 0.2991586483855785 cos_sim:  -0.03378324096830539
epoch:  1 -226259.08
epoch:  1 0.3727328460907415 cos_sim:  0.0613256835356213
0.40611469626224267 cos_sim:  0.1316328745274776
Finished fitting model to verb trials
Parameter containing:
tensor([[-0.1459,  0.0497, -0.3422,  ..., -0.5463,  0.3432,  0.1252],
        [-0.0474,  0.5855, -0.1972,  ..., -1.1779,  0.8516,  0.1308],
        [-0.0075,  0.9350, -0.1395,  ..., -1.4121,  1.1840,  0.0991],
        ...,
        [ 0.3087,  0.0927,  0.5309,  ..., -0.2467, -0.3136, -0.3205],
        [ 0.0610, -0.0505,  0.2432,  ..., -0.1377, -0.1303, -0.0180],
        [ 0.6588,  0.8197,  0.7376,  ..., -0.5250, -0.9487, -0.7905]],
       requires_grad=True)
epoch:  0 -225598.94
epoch:  0 0.24050397105213842 cos_sim:  -0.11293796016684386
epoch:  1 -226266.38
epoch:  1 0.2686781819479934 cos_sim:  -0.08461728535573149
0.26702620405797833 cos_sim:  -0.034186331535381
Finished fitting model to noise trials
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>Let’s Compare Simulated &amp; Empirical MEG Activity</p></li>
</ol>
<blockquote>
<div></div></blockquote>
<p>we will use the simulations from the fully trained model in the downloaded directory</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">verb_meg_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;sim_verb_sensor.npy&#39;</span><span class="p">))</span>
<span class="n">noise_meg_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;sim_noise_sensor.npy&#39;</span><span class="p">))</span>
<span class="c1"># Use existing MEG channel structure to use MNE format</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;info.pkl&#39;</span><span class="p">),</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="c1"># Convert empirical data to MNE format</span>
<span class="n">emp_verb_evoked</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">EvokedArray</span><span class="p">(</span><span class="n">verb_meg</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:],</span> <span class="n">info</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">emp_noise_evoked</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">EvokedArray</span><span class="p">(</span><span class="n">noise_meg</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:],</span> <span class="n">info</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">)</span>
<span class="c1"># Convert simulated data to MNE format</span>
<span class="n">sim_verb_evoked</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">EvokedArray</span><span class="p">(</span><span class="n">verb_meg_sim</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">500</span><span class="p">],</span> <span class="n">info</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">sim_noise_evoked</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">EvokedArray</span><span class="p">(</span><span class="n">noise_meg_sim</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">500</span><span class="p">],</span> <span class="n">info</span><span class="p">,</span> <span class="n">tmin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">)</span>
<span class="c1"># Plot empirical verb trial</span>
<span class="n">emp_verb_evoked</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Empirical Verb&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="p">[</span><span class="mf">0.07</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1585</span><span class="p">])</span>
<span class="c1"># Plot simulated verb trial</span>
<span class="n">sim_verb_evoked</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Simulated Verb&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="p">[</span><span class="mf">0.07</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1585</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># Plot empirical noise trial</span>
<span class="n">emp_noise_evoked</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Empirical Noise&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="p">[</span><span class="mf">0.07</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1585</span><span class="p">])</span>
<span class="c1"># Plot simulated noise trial</span>
<span class="n">sim_noise_evoked</span><span class="o">.</span><span class="n">plot_joint</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Simulated Noise&quot;</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="p">[</span><span class="mf">0.07</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1585</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img src="../_images/sphx_glr_eg__ismail2025_001.png" srcset="../_images/sphx_glr_eg__ismail2025_001.png" alt="Empirical Verb, 0.070 s, 0.100 s, 0.159 s" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/sphx_glr_eg__ismail2025_002.png" srcset="../_images/sphx_glr_eg__ismail2025_002.png" alt="Simulated Verb, 0.070 s, 0.100 s, 0.159 s" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/sphx_glr_eg__ismail2025_003.png" srcset="../_images/sphx_glr_eg__ismail2025_003.png" alt="Empirical Noise, 0.070 s, 0.100 s, 0.159 s" class = "sphx-glr-multi-img"/></li>
<li><img src="../_images/sphx_glr_eg__ismail2025_004.png" srcset="../_images/sphx_glr_eg__ismail2025_004.png" alt="Simulated Noise, 0.070 s, 0.100 s, 0.159 s" class = "sphx-glr-multi-img"/></li>
</ul>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>No projector specified for this dataset. Please consider the method self.add_proj.
No projector specified for this dataset. Please consider the method self.add_proj.
No projector specified for this dataset. Please consider the method self.add_proj.
No projector specified for this dataset. Please consider the method self.add_proj.
</pre></div>
</div>
<dl class="simple">
<dt><strong>Results Description:</strong></dt><dd><p>Models successfully reproduced the timing and spatial topography of the early evoked MEG components (0-400 ms) observed for both conditions.</p>
</dd>
</dl>
<p>Figure 1C shows the model-generated and empirical MEG time series during noun and noise trials for an exemplar subject.</p>
<ol class="arabic simple" start="8">
<li><p>Simulate models for longer (model was fitted with 500 ms of data, we will simulate 1500 ms!)</p></li>
</ol>
<blockquote>
<div></div></blockquote>
<p>We are interested in capturing changes in beta power between verb and noise trials observed from 700-1200 ms
Create longer empty array with same shape and fill with the first 500 ms</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">sim_1500_verb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">verb_meg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1500</span><span class="p">))</span>
<span class="n">sim_1500_verb</span><span class="p">[:,:</span><span class="n">verb_meg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">verb_meg</span><span class="o">*</span><span class="mf">1.0e13</span>
<span class="n">node_size</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">output_size</span> <span class="o">=</span> <span class="n">sim_1500_verb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">step_size</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">input_size</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">num_epoches</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">tr</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">state_size</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">base_batch_num</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">time_dim</span> <span class="o">=</span> <span class="n">sim_1500_verb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tr</span><span class="o">/</span><span class="n">step_size</span><span class="p">)</span>
<span class="n">data_mean</span> <span class="o">=</span> <span class="n">dataloader</span><span class="p">((</span><span class="n">sim_1500_verb</span><span class="o">-</span><span class="n">sim_1500_verb</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">num_epoches</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
<span class="n">verb_F</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">data_mean</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">node_size</span><span class="p">,</span><span class="n">hidden_size</span><span class="p">,</span><span class="n">time_dim</span><span class="p">))</span>
<span class="n">u</span><span class="p">[:,:,</span><span class="mi">100</span><span class="p">:</span><span class="mi">140</span><span class="p">]</span><span class="o">=</span> <span class="mi">5000</span>
<span class="n">output_test</span> <span class="o">=</span> <span class="n">verb_F</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">base_batch_num</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">)</span>
<span class="c1">#extract simulated sensor and source data for noise trials</span>
<span class="n">sim_source_verb</span> <span class="o">=</span> <span class="n">verb_F</span><span class="o">.</span><span class="n">output_sim</span><span class="o">.</span><span class="n">P_test</span>
<span class="n">sim_sensor_verb</span> <span class="o">=</span> <span class="n">verb_F</span><span class="o">.</span><span class="n">output_sim</span><span class="o">.</span><span class="n">eeg_test</span>

<span class="c1">#repeat for noise trials</span>
<span class="n">sim_1500_noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">noise_meg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1500</span><span class="p">))</span>
<span class="n">sim_1500_noise</span><span class="p">[:,:</span><span class="n">noise_meg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">noise_meg</span><span class="o">*</span><span class="mf">1.0e13</span>
<span class="n">node_size</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">output_size</span> <span class="o">=</span> <span class="n">sim_1500_noise</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">250</span>
<span class="n">step_size</span> <span class="o">=</span> <span class="mf">0.0001</span>
<span class="n">input_size</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">num_epoches</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">tr</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">state_size</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">base_batch_num</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">time_dim</span> <span class="o">=</span> <span class="n">sim_1500_noise</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tr</span><span class="o">/</span><span class="n">step_size</span><span class="p">)</span>
<span class="n">data_mean</span> <span class="o">=</span> <span class="n">dataloader</span><span class="p">((</span><span class="n">sim_1500_noise</span><span class="o">-</span><span class="n">sim_1500_noise</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">num_epoches</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
<span class="n">noise_F</span><span class="o">.</span><span class="n">ts</span> <span class="o">=</span> <span class="n">data_mean</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">node_size</span><span class="p">,</span><span class="n">hidden_size</span><span class="p">,</span><span class="n">time_dim</span><span class="p">))</span>
<span class="n">u</span><span class="p">[:,:,</span><span class="mi">100</span><span class="p">:</span><span class="mi">140</span><span class="p">]</span><span class="o">=</span> <span class="mi">5000</span>
<span class="n">output_test</span> <span class="o">=</span> <span class="n">noise_F</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">base_batch_num</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">)</span>
<span class="c1">#extract simulated sensor and source data for noise trials</span>
<span class="n">sim_source_noise</span> <span class="o">=</span> <span class="n">noise_F</span><span class="o">.</span><span class="n">output_sim</span><span class="o">.</span><span class="n">P_test</span>
<span class="n">sim_sensor_noise</span> <span class="o">=</span> <span class="n">noise_F</span><span class="o">.</span><span class="n">output_sim</span><span class="o">.</span><span class="n">eeg_test</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>0.42809531823003727 cos_sim:  0.1020385372477985
0.24082111990695101 cos_sim:  -0.038536761666397815
</pre></div>
</div>
<ol class="arabic simple" start="9">
<li><p>Compare empirical and simulated change in beta power between verb and noise trials for one subject</p></li>
</ol>
<blockquote>
<div></div></blockquote>
<p>We are replicating figure 1D (Adolescents) for one subject
We will load the empirical source data (model was fitted with sensor MEG data) and simulated source from pretrained model</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">emp_source_noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;emp_noise_source.npy&#39;</span><span class="p">))</span>
<span class="n">emp_source_verb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;emp_verb_source.npy&#39;</span><span class="p">))</span>
<span class="n">sim_source_noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;sim_noise_source.npy&#39;</span><span class="p">))</span>
<span class="n">sim_source_verb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;sim_verb_source.npy&#39;</span><span class="p">))</span>

<span class="c1">#Compute beta power</span>
<span class="c1"># Sampling parameters</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># Sampling frequency (Hz)</span>
<span class="n">nperseg</span> <span class="o">=</span> <span class="mi">512</span>  <span class="c1"># Segment length (500 ms)</span>
<span class="n">noverlap</span> <span class="o">=</span> <span class="mi">256</span>  <span class="c1"># 50% overlap</span>
<span class="c1"># Index of frequency range for beta power corresponding to (13-30 Hz)</span>
<span class="n">start_freq</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">end_freq</span> <span class="o">=</span> <span class="mi">16</span>
<span class="c1">#We focus on the frontal regions</span>
<span class="c1"># Define frontal ROIs of shen atlas based on mask (subtract 1 for Python indexing)</span>
<span class="n">frontal_rois</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span>
                         <span class="mi">37</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span>
                         <span class="mi">78</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span>
                         <span class="mi">108</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span>
                         <span class="mi">140</span><span class="p">,</span> <span class="mi">142</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">158</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">172</span><span class="p">,</span> <span class="mi">178</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">183</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>

<span class="c1"># Separate left and right hemisphere indices</span>
<span class="n">right_frontal_idx</span> <span class="o">=</span> <span class="n">frontal_rois</span><span class="p">[</span><span class="n">frontal_rois</span> <span class="o">&lt;</span> <span class="mi">93</span><span class="p">]</span>
<span class="n">left_frontal_idx</span> <span class="o">=</span> <span class="n">frontal_rois</span><span class="p">[</span><span class="n">frontal_rois</span> <span class="o">&gt;</span> <span class="mi">93</span><span class="p">]</span>
<span class="n">emp_verb_psd</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">emp_source_verb</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1200</span><span class="p">:</span><span class="mi">1700</span><span class="p">],</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">noverlap</span><span class="o">=</span><span class="n">noverlap</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">nperseg</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="n">emp_noise_psd</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">emp_source_noise</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1200</span><span class="p">:</span><span class="mi">1700</span><span class="p">],</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">noverlap</span><span class="o">=</span><span class="n">noverlap</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">nperseg</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="n">sim_verb_psd</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">sim_source_verb</span><span class="p">[:,</span> <span class="mi">800</span><span class="p">:</span><span class="mi">1300</span><span class="p">],</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">noverlap</span><span class="o">=</span><span class="n">noverlap</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">nperseg</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="n">sim_noise_psd</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">welch</span><span class="p">(</span><span class="n">sim_source_noise</span><span class="p">[:,</span> <span class="mi">800</span><span class="p">:</span><span class="mi">1300</span><span class="p">],</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">noverlap</span><span class="o">=</span><span class="n">noverlap</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="n">nperseg</span><span class="p">,</span> <span class="n">detrend</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="c1">#We average beta power across trials</span>
<span class="n">emp_verb_beta</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">emp_verb_psd</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">start_freq</span><span class="p">:</span><span class="n">end_freq</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">emp_noise_beta</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">emp_noise_psd</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">start_freq</span><span class="p">:</span><span class="n">end_freq</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">sim_verb_beta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sim_verb_psd</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="n">start_freq</span><span class="p">:</span><span class="n">end_freq</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">sim_noise_beta</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sim_noise_psd</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span> <span class="n">start_freq</span><span class="p">:</span><span class="n">end_freq</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">emp_beta_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">emp_verb_beta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">emp_noise_beta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">sim_beta_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sim_verb_beta</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sim_noise_beta</span><span class="p">))</span>
<span class="c1">#We seperate right and left regions to observe ERD in the left and ERS in the right</span>
<span class="n">right_emp_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">emp_beta_diff</span><span class="p">[</span><span class="n">right_frontal_idx</span><span class="p">])</span>
<span class="n">left_emp_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">emp_beta_diff</span><span class="p">[</span><span class="n">left_frontal_idx</span><span class="p">])</span>
<span class="n">right_sim_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sim_beta_diff</span><span class="p">[</span><span class="n">right_frontal_idx</span><span class="p">])</span>
<span class="n">left_sim_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sim_beta_diff</span><span class="p">[</span><span class="n">left_frontal_idx</span><span class="p">])</span>
<span class="c1">#Plot beta power difference in left and right frontal regions</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span> <span class="s1">&#39;Simulated&#39;</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.35</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">left_emp_avg</span><span class="p">,</span> <span class="n">left_sim_avg</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Left Frontal&#39;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#6a9ef9&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#6a9ef9&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">right_emp_avg</span><span class="p">,</span> <span class="n">right_sim_avg</span><span class="p">],</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Right Frontal&#39;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#e97773&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;#e97773&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Verb-Noise Beta Power&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img src="../_images/sphx_glr_eg__ismail2025_005.png" srcset="../_images/sphx_glr_eg__ismail2025_005.png" alt="eg  ismail2025" class = "sphx-glr-single-img"/><div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.10.17/x64/lib/python3.10/site-packages/scipy/signal/_spectral_py.py:790: UserWarning: nperseg = 512 is greater than input length  = 500, using nperseg = 500
  freqs, _, Pxy = _spectral_helper(x, y, fs, window, nperseg, noverlap,
</pre></div>
</div>
<p><strong>Results Description:</strong>
Remarkably, despite being trained solely on early responses (0–400 ms), the models generalized beyond the fitted time window and domain, predicting beta-band oscillations (13-30 Hz) observed in a later time window during language production (700–1200 ms; Fig. 1B) in the frequency domain (Fig. 1D). This is a non-trivial result that highlights the model’s capacity to link temporal and spectral features of neural dynamics during the task. For this adolescent subject, models predicted a left-lateralized pattern, with left-right difference in the noun-noise beta power difference. Specifically, lower beta power, relative to noise trials, in the left frontal lobe (ERD) and greater beta power in the right (ERS) was observed. In the paper (Figure 1E) we compare the pattern of beta ERD/S between young children and adolescents and uur simulations captured developmental differences in the degree of lateralization of language production oscillatory patterns in response to speech versus noise (Fig. 1E).</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (8 minutes 17.066 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-eg-ismail2025-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/fa46508a782571b79143e92910a4f1a8/eg__ismail2025.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">eg__ismail2025.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/aa6e2730d4e80caab205a65dd1ce8bb6/eg__ismail2025.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">eg__ismail2025.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../_downloads/12b04a24b2b01289f457e3af0292c3b8/eg__ismail2025.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">eg__ismail2025.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


  
</div>

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">0. Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">1. Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-data">2. Download data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-forward-model-input">4. Load Forward Model Input</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-structure">5. Load Structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#put-it-all-together-and-fit-the-model">6. Put it all together and fit the model</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

    <script src="https://mne.tools/versionwarning.js"></script>
  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item"><p class="text-center small">&copy; Copyright </p></div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>